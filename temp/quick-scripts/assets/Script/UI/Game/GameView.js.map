{"version":3,"sources":["GameView.js"],"names":["Utils","require","HexCell","Role","Enemy","Tower","colors","hexTileHeight","sideLength","cc","Class","extends","Component","properties","shootings","default","type","Node","invAgain","mission","gm","title","Label","star1","star2","star3","moves","best","RichText","tileBox","iceBox","maxValidMoves","Integer","visible","movesLeft","moved","leaveSteps","levelDimensions","v2","gridOffset","hexCellPrefab","icePrefab","rolePrefab","enemyPrefab","enemyPrefab1","enemyPrefab2","endPrefab","allCells","allTowers","myRole","enemys","helplines","stepsLines","endObj","selectedLines","mouseIsDown","userInputEnabled","gameOver","prevTilePosition","mouseOffsetPos","touchPos","movePlus","get","helpPath","helpShaked","helpBtn","helpCountLabel","_helpCount","helpCount","set","v","string","toString","param","SDK","setItem","getChildByName","active","shareFriendTip","adSprite","Sprite","receiveGiftNode","giftBtn","preBtn","nextBtn","endView","endView_Stars","endView_title","endView_text","gameApplication","Object","isMoving","lastDirection","turnBackCount","timesNode","timesVal","timesLeft","timeOutflowCB","timeIsUpNode","timeIsUpEndNode","gotMoreTime","opad_game_id","isinigame","onLoad","node","width","winSize","height","plusMoreHelp","plusHelp","clearHelp","clearData","onEnable","scheduleOnce","init","unschedule","shootingStars","schedule","i","length","shootAnim","delay","Math","random","x","y","GetRandomNum","runAction","moveBy","bind","start","gameApplicationNode","find","getComponent","onBackBtnClicked","on","EventType","TOUCH_START","event","onMouseDown","TOUCH_MOVE","onMouseMove","onDisable","clear","timeOutflow","clearTile","splice","currentLineColor","oldCurrentLineColor","childrenCount","n","children","destroy","self","bid","mid","lid","path","getConf","results","console","log","initGame","arr","push","forEach","tmp_lid","tmp_path","initHelpBtn","getItem","count","curIdx","judgeIdx","window","lastPlay","lines","linesCount","levelInfo","grid","createGrid","createRole","initHelpPath","cloneObj","enemy","createEnemy","getSteps","updateUI","t","interval","repeat","axialCoordinate","test","checkXY","canMovePath","checkMovePos","j","testV2","soundManager","playSound","color","hexToColor","hasVideoAd","stopAllAction","getMoreTime","target","Button","interactable","onVideoBtnClick","isCompleted","addTime","coin","coins","showCoinView","getMoreTimeInv","score","share","showInvAgain","restarGame","stopAllActions","onyRole","helpStart","helpIdx","stepCount","isContinue","hc","getCellByCoordinate","canMove","checkCanMoveCount","checkMove","help","tmpPath","selected","equals","showHelpLine","startV2","isNeighbors","isIce","tmp_coordinate","showStartHelp","showEndHelp","showHelp","update","dt","roundMove","tower","towerShoot","isShooting","bubble","bubbleAxialCoordinate","direction","cb1","callFunc","play","delay0","delayTime","cb2","position","pCompMult","getPosition","opacity","cb4","seq","sequence","scale","nextPos","add","worldPosition","convertToWorldSpaceAR","hcPos_tmp","convertToNodeSpaceAR","hcPos","a1","moveTo","checkMoveDirectionCount","idx","getLocation","movePos","offsetX","offsetY","abs","doAction","_coordinate","die","playDie","openMainView","showGameOver","curr_star","star","mainScirpt","initStage","saveCount","timeGiftScript","showTimeGiftView","plusStar","setRankScore","all","playTimes","StartRecourd","backToMain","floor","onOpAdClicked","switchGameAsync","checkWin","isWin","moveEnd","inArray","helpBtnShake","setArrow","addSelectedLines","coordinate","pop","hideLine","showStartLine","showEndLine","showLine","manual","hideArrow","isTurnBack","getkMoveDirection","c","neighbors","getNeighborsOBJ","l","d","r","leftActive","rightActive","topActive","bottomActive","tc","dc","b","lc","rc","enemy_GO","instantiate","parent","setScale","setPosition","end","hc1","role_GO","role","end_GO","endNode","gameView","setDark","collisionCallback","_levelDimensions","walls","ices","towers","cb","maxL","max","tileBoxSize","getContentSize","tileBoxHeight","hexH","lineWidth","nowHeight","testHexTileHeight","sizeW","sizeH","hexTile","axialPoint","screenPoint","axialToScreen","setContentSize","size","name","zIndex","scaleChild","wx","wy","dx","dy","wall","tmp_w1","tmp_d1","w1","d1","setLeft","setTop","setRight","setBottom","ice","setIce","iceNode","scaleTo","min","setRightTower","pushTower","rightTower","setLeftTower","leftTower","setTopTower","topTower","setBottomTower","bottomTower","config","dict","showStepView","isOk","setStar","f","onNextBtnClicked","btn","nextGame","onPreviousBtnClicked","prevGame","onReStarBtnClicked","onHelpBtnClicked","onWatchVideoBtnClicked","showVideoAd","onShareInvBtnClicked","onShareBtnClicked","onCloseWatchVideoTipClicked","shake","onGiftBtnClicked","onPlayInterstitialGiftBtnClicked","showInterstitialAd"],"mappings":"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","file":"GameView.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\UI\\Game","sourcesContent":["var Utils = require(\"../../Utils/Utils\");\nvar HexCell = require(\"./HexCell\");\nvar Role = require(\"./Role\");\nvar Enemy = require(\"./Enemy\");\nvar Tower = require(\"./Tower\");\n\nvar colors = [\n    \"#5d3eaf\",\n    \"#4ba3e8\",\n    \"#9d9e9d\",\n    \"#67798a\",\n    \"#f19b38\"\n];\n\n\nvar hexTileHeight = 100;    //actually the width of the hex tile graphic (distance between the pointy opposite corners)\nvar sideLength; //this is the lendth of one side of the hexagon or the length of a corner to centre of the hexagon\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        shootings: {\n            default: [],\n            type: [cc.Node],\n        },\n        invAgain: {\n            default: null,\n            type: cc.Node,\n        },\n        mission: {\n            default: null,\n        },\n        gm: {\n            default: null,\n            type: cc.Node,\n        },\n        title: {\n            default: null,\n            type: cc.Label,\n        },\n        star1: {\n            default: null,\n            type: cc.Node,\n        },\n        star2: {\n            default: null,\n            type: cc.Node,\n        },\n        star3: {\n            default: null,\n            type: cc.Node,\n        },\n        moves: {\n            default: null,\n            type: cc.Label,\n        },\n        best: {\n            default: null,\n            type: cc.RichText,\n        },\n        tileBox: {\n            default: null,\n            type: cc.Node,\n        },\n        iceBox: {\n            default: null,\n            type: cc.Node,\n        },\n        maxValidMoves: {\n            default: 0,\n            type: cc.Integer,\n            visible: false,\n        },\n        movesLeft: {\n            default: 0,\n            type: cc.Integer,\n            visible: false,\n        },\n        moved: {\n            default: 0,\n            type: cc.Integer,\n            visible: false,\n        },\n        leaveSteps: {\n            default: null,\n            type: cc.Node,\n        },\n        //grid size colum x row\n        levelDimensions: {\n            default: cc.v2(0, 0),\n            visible: false,\n        },\n        //position of the full grid\n        gridOffset: {\n            default: cc.v2(0, 0),\n            visible: false,\n        },\n        hexCellPrefab: {\n            default: null,\n            type: cc.Node,\n        },\n        icePrefab: {\n            default: null,\n            type: cc.Node,\n        },\n        rolePrefab: {\n            default: null,\n            type: cc.Node,\n        },\n        enemyPrefab: {\n            default: null,\n            type: cc.Node,\n        },\n        enemyPrefab1: {\n            default: null,\n            type: cc.Node,\n        },\n        enemyPrefab2: {\n            default: null,\n            type: cc.Node,\n        },\n        endPrefab: {\n            default: null,\n            type: cc.Node,\n        },\n        //list of all the cells in the grid\n        allCells: {\n            default: [],\n            type: [HexCell],\n        },\n        allTowers: {\n            default: [],\n            type: [Tower],\n        },\n        myRole: {\n            default: null,\n            type: Role,\n        },\n        enemys: {\n            default: []\n        },\n        helplines: {\n            default: []\n        },\n        stepsLines: {\n            default: []\n        },\n        endObj: {\n            default: null,\n            type: Role,\n        },\n\n        selectedLines: {\n            default: [],\n        },\n\n        mouseIsDown: false,\n        userInputEnabled: false,\n        gameOver: false,\n\n        prevTilePosition: {\n            default: cc.v2(-1000, -1000),\n            visible: false,\n        },\n        mouseOffsetPos: {\n            default: cc.v2(0, 0),\n            visible: false,\n        },\n        touchPos: {\n            default: cc.v2(0, 0),\n            visible: false,\n        },\n\n        movePlus: {\n            get: function () {\n                //t,l,d,r\n                return [\n                    cc.v2(0, 1), //top\n                    cc.v2(-1, 0), //left\n                    cc.v2(0, -1), //down\n                    cc.v2(1, 0)  //right\n                ];\n            }\n        },\n\n        helpPath: {\n            default: [],\n        },\n        helpShaked: {\n            default: [],\n        },\n        helpBtn: {\n            default: null,\n            type: cc.Node,\n        },\n        helpCountLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        _helpCount: {\n            default: 0,\n            type: cc.Integer,\n        },\n        helpCount: {\n            get: function () {\n                return this._helpCount;\n            },\n            set: function (v) {\n                this._helpCount = v;\n                this.helpCountLabel.string = v.toString();\n\n                var param = {};\n                param[\"my_help\"] = this._helpCount > 0 ? this._helpCount : -1;\n                SDK().setItem(param, null);\n\n                this.helpBtn.getChildByName(\"icon\").active = true;\n                this.helpBtn.getChildByName(\"num\").active = true;\n\n            },\n        },\n        shareFriendTip: {\n            default: null,\n            type: cc.Node,\n        },\n        adSprite: {\n            default: null,\n            type: cc.Sprite,\n        },\n        receiveGiftNode: {\n            default: null,\n            type: cc.Node,\n        },\n        giftBtn: {\n            default: null,\n            type: cc.Node,\n        },\n        preBtn: {\n            default: null,\n            type: cc.Node,\n        },\n        nextBtn: {\n            default: null,\n            type: cc.Node,\n        },\n        endView: {\n            default: null,\n            type: cc.Node,\n        },\n        endView_Stars: {\n            default: null,\n            type: cc.Node,\n        },\n        endView_title: {\n            default: null,\n            type: cc.Label,\n        },\n        endView_text: {\n            default: null,\n            type: cc.RichText,\n        },\n        gameApplication: {\n            default: null,\n            type: Object\n        },\n        isMoving: false,\n        //最后行走方向\n        lastDirection: {\n            default: -1,\n            type: cc.Integer,\n        },\n        turnBackCount: {\n            default: 0,\n            type: cc.Integer,\n        },\n        timesNode: {\n            default: null,\n            type: cc.Node,\n        },\n        timesVal: {\n            default: null,\n            type: cc.Label,\n        },\n        timesLeft: {\n            default: 0,\n            type: cc.Integer,\n        },\n        timeOutflowCB: {\n            default: null\n        },\n        timeIsUpNode: {\n            default: null,\n            type: cc.Node,\n        },\n        timeIsUpEndNode: {\n            default: null,\n            type: cc.Node,\n        },\n        gotMoreTime: false,\n        opad_game_id: null,\n\t\tisinigame:false,\n\n    },\n\n    onLoad: function () {\n        this.node.width = cc.winSize.width;\n        this.node.height = cc.winSize.height;\n        \n    },\n\n    plusMoreHelp() {\n        this.helpCount += plusHelp;\n    },\n\n    clearHelp() {\n        this.helpCount = 0;\n    },\n\n    clearData() {\n        SDK().clearData();\n    },\n\n    onEnable() {\n        this.scheduleOnce(function () {\n            this.init();\n        }, 0.7)\n\n        //注册流行事件\n        this.unschedule(this.shootingStars);\n        this.schedule(this.shootingStars, 4);\n        \n    },\n\n    //流行事件\n    shootingStars() {\n        for (var i = 0; i < this.shootings.length; i = i + 1) {\n            this.shootAnim(this.shootings[i]);\n        }\n    },\n\n    //流行动画\n    shootAnim(node) {\n        var delay = Math.random() * 3;\n        node.x = cc.winSize.width + 100;\n        node.y = Utils.GetRandomNum(cc.winSize.height * 0.5, cc.winSize.height * 2);\n        this.scheduleOnce(function () {\n            node.runAction(cc.moveBy(0.5, cc.v2(-(cc.winSize.width * 2.5), -(cc.winSize.width * 2.5))));\n        }.bind(this), delay)\n    },\n\n    start() {\n\n        \n\n        var gameApplicationNode = cc.find(\"GameApplication\");\n        if (gameApplicationNode != null) {\n            this.gameApplication = gameApplicationNode.getComponent(\"GameApplication\");\n        }\n\n        if (typeof this.gameApplication === 'undefined' || this.gameApplication == null) {\n            this.onBackBtnClicked();\n            return;\n        }\n\n        this.gm.active = false\n\n\n        this.node.on(cc.Node.EventType.TOUCH_START, function (event) {\n            this.onMouseDown(event);\n        }, this);\n\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\n            this.onMouseMove(event);\n        }, this);\n\n        // this.node.on(cc.Node.EventType.TOUCH_END, function (event) {\n        //     this.onMouseUp(event);\n        // }, this);\n\n        // this.node.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {\n        //     this.onMouseUp(event);\n        // }, this);\n    },\n\n\n    onDisable() {\n        this.clear();\n    },\n\n    clear() {\n\n        this.unschedule(this.timeOutflow);\n\n        this.clearTile();\n\n        this.allCells.splice(0, this.allCells.length);\n        this.allTowers.splice(0, this.allTowers.length);\n        this.selectedLines.splice(0, this.selectedLines.length);\n        this.enemys.splice(0, this.enemys.length);\n        this.helplines.splice(0, this.helplines.length);\n        this.myRole = null;\n        this.helpShaked.splice(0, this.helpShaked.length);\n\n        if (this.helpPath != null && this.helpPath.length > 0) {\n            this.helpPath.splice(0, this.helpPath.length);\n        }\n\n        // Xuanyou.Util.DestroyAllChilds (tileBox);\n\n        hexTileHeight = 100;\n        this.mouseIsDown = false;\n        this.gameOver = false;\n        this.movesLeft = 0;\n        this.moved = 0;\n        this.turnBackCount = 0;\n        this.lastDirection = -1;\n        this.isMoving = false;\n\n        // this.filling = 0;\n        // this.filling_str = \"0\";\n        this.currentLineColor = 0;\n        this.oldCurrentLineColor = 0;\n\n        // this.m_Num = 0;\n        // this.m_tweenNum = 0;\n    },\n\n    clearTile() {\n        // cc.log(\"this.tileBox.childrenCount:\"+this.tileBox.childrenCount)\n        if (this.tileBox.childrenCount > 0) {\n            //如果有child，destroy\n            for (var i = 0; i < this.tileBox.childrenCount; i++) {\n                var n = this.tileBox.children[i];\n                if (n != null) {\n                    n.active = false;\n                    n.destroy();\n                }\n            }\n        }\n\n        if (this.iceBox.childrenCount > 0) {\n            //如果有child，destroy\n            for (var i = 0; i < this.iceBox.childrenCount; i++) {\n                var n = this.iceBox.children[i];\n                if (n != null) {\n                    n.active = false;\n                    n.destroy();\n                }\n            }\n        }\n    },\n\n\n    init() {\n        //cc.warn(\"____________________conf/level_detail/b_\" + bid + \"/\" + mid + \"/\" + lid + \".json\");\n\n        var self = this;\n        this.selectedLines = [];\n        this.enemys = [];\n        this.helplines = [];\n        this.helpPath = [];\n        this.myRole = null;\n        this.isMoving = false;\n\n        this.endView.active = false;\n        this.timeIsUpNode.active = false;\n        this.gotMoreTime = false;\n        if (bid != null && bid > 0 && mid != null && mid > 0 && lid != null && lid > 0) {\n            var path = \"conf/level_detail/b_\" + bid + \"/\" + mid + \"/\" + lid;\n            this.gameApplication.getConf(path, function (results) {\n                this.mission = results;\n                console.log(results);\n                this.initGame();\n            }.bind(this));\n\n            //预加载上下两关\n            var arr = [];\n            if (lid > 1) {\n                arr.push(lid - 1);\n            }\n            if (lid < 100) {\n                arr.push(lid + 1);\n            }\n            arr.forEach(function (tmp_lid) {\n                var tmp_path = \"conf/level_detail/b_\" + bid + \"/\" + mid + \"/\" + tmp_lid;\n                self.gameApplication.getConf(tmp_path, null);\n            });\n\n            //init HelpBtn\n            this.initHelpBtn();\n\n        } else {\n            this.onBackBtnClicked();\n        }\n    },\n\n    initHelpBtn() {\n        var self = this;\n        SDK().getItem(\"my_help\", function (count) {\n            if (count == 0) {\n                self.helpCount = 5;\n            } else if (count == -1) {\n                self.helpCount = 0;\n            } else {\n                self.helpCount = count;\n            }\n        }.bind(this));\n    },\n\n    initGame() {\n        //SDK注释游戏开始接入录屏\n        // D.sdk.hideBanner();\n        // D.sdk.recorderStart();\n        // D.sdk.recorderStart();\n\t\t//cc.log(\"#######################-----------find-----------3----\"+this.isinigame);\n\t\tif( this.isinigame )\n\t\t{\n\n\t\t\treturn;\t\n\t\t}\n\t\tthis.isinigame =true;\n\t\t\n        var curIdx = this.judgeIdx(mid, lid);\n        window.lastPlay = curIdx;\n        this.timeIsUpNode.active = false;\n        this.timeIsUpEndNode.active = false;\n        this.gotMoreTime = false;\n        this.leaveSteps.active = false;\n        this.endView.active = false;\n        this.clear();\n\n        //cc.log(\"this.mission:\",this.mission)\n\n        var lines = this.mission['lines'];\n        var linesCount = lines.length;\n\n        this.turnBackCount = 0;\n        this.helpShaked.splice(0, this.helpShaked.length);\n\n        this.lastDirection = -1;\n\n\n        var path = \"conf/level_list/level_\" + bid + '_' + mid;\n        this.gameApplication.getConf(path, function (results) {\n            var levelInfo = results;\n            //这里是头上的英文字体，如果修改需要耗费大量时间，直接注释掉\n            //this.title.string = levelInfo['title'] + \" \" + lid;  \n        }.bind(this));\n\n\n        // this.moves.string = \"<color=#ff0000>0</c>/\"+this.mission['moves'];\n        this.moves.string = \"0/\" + linesCount;\n\n\n\n        //判断是否有上一关\n        this.preBtn.active = false;\n        this.nextBtn.active = false;\n\n        //最好成绩\n        SDK().getItem(bid + \"_\" + mid + \"_\" + lid + \"_moves\", function (best) {\n            if (best <= 0) {\n                this.best.string = \"-\";\n            } else {\n                this.best.string = best.toString();\n            }\n        }.bind(this));\n\n\n        //初始化格子\n        var grid = cc.v2(this.mission['x'], this.mission['y']);\n        this.createGrid(grid, this.mission[\"walls\"], this.mission[\"ice\"], this.mission[\"tower\"], function () {\n\n            this.scheduleOnce(function () {\n                //初始化球的位置\n                this.createRole(this.mission['start'], this.mission['end']);\n\t\t\t\t//cc.log(\"#######################-----------find-----------2\");\n                //初始化帮助\n                this.initHelpPath(Utils.cloneObj(this.mission[\"lines\"]));\n\n                var enemy = this.mission['enemy'];\n                if (enemy.length > 0) {\n                    this.createEnemy(this.mission['enemy']);\n                }\n\n                //初始化步数模式\n                if (mid == 1) {\n                    this.moved = 0;\n                    this.maxValidMoves = this.getSteps();\n                    this.maxValidMoves = this.maxValidMoves +15;\n                    this.movesLeft = this.maxValidMoves;\n                    this.leaveSteps.active = true;\n                    this.updateUI();\n                }\n\n\n                //初始化时间模式\n                if (mid == 3) {\n                    // cc.log(\"初始化时间模式\")\n                    var t = 12;\n                    if (lid <= 5) {\n                        t = 12+50;\n                    } else if (lid <= 20) {\n                        t = 15+50;\n                    } else if (lid <= 45) {\n                        t = 20+50;\n                    } else if (lid <= 75) {\n                        t = 25+50;\n                    } else {\n                        t = 30+50;\n                    }\n\n                    this.timesLeft = t;\n                    this.timesNode.active = true;\n                    this.timesVal.string = t.toString()\n\n                    var interval = 1;\n                    var repeat = t;\n                    var delay = 1;\n\n                    this.schedule(this.timeOutflow, interval, repeat, delay);\n                } else {\n                    this.timesLeft = -1;\n                    this.timesNode.active = false;\n                }\n            }.bind(this), 0.5)\n        }.bind(this));\n    },\n\n    initHelpPath(helpPath) {\n        //cc.log(\"initHelpPath:\",helpPath);\n        // this.helpPath = helpPath;\n        // cc.log(\"+++++++++++==mid:\",mid)\n        if (mid != 2 && mid != 4 && mid != 6) {\n            this.helpPath = helpPath;\n            //cc.log(\"______\", this.helpPath)\n        } else {\n            //cc.log(\"_______________\")\n            this.helpPath = [];\n            this.helpPath.push(this.myRole.axialCoordinate);\n\n            var test = 0;\n            while (helpPath.length > 0) {\n                for (var i = 0; i < helpPath.length; i++) {\n                    var path = helpPath[i];\n                    // cc.log(\"_____check:\",path);\n\n                    if (path != null) {\n                        path = this.checkXY(path, 0, 0);\n                        var canMovePath = this.checkMovePos(path);\n                        // cc.log(\"canMovePath:\",canMovePath);\n                        // cc.log(\"this.helpPath[this.helpPath.length-1]:\",this.helpPath[this.helpPath.length-1]);\n                        for (var j = 0; j < canMovePath.length; j++) {\n\n                            var testV2 = this.helpPath[this.helpPath.length - 1];\n                            if (canMovePath[j].x == testV2.x && canMovePath[j].y == testV2.y) {\n                                this.helpPath.push(helpPath[i]);\n                                helpPath.splice(i, 1)\n                                break;\n                            }\n                        }\n                    }\n\n\n                }\n                test++;\n\n\n                if (test >= 500) {\n                    // cc.log(\"helpPath:\",JSON.stringify(helpPath));\n                    helpPath.splice(0, helpPath.length);\n                    helpPath = [];\n                }\n            }\n        }\n\n        this.stepsLines = this.helpPath;\n\n        // cc.log(\"____________this.helpPath:\",this.helpPath);\n\n\n    },\n\n    timeOutflow() {\n        //时间模式\n        // cc.log(\"时间模式:\",this.timesLeft)\n        var self = this;\n        if (this.timesLeft > 0) {\n            this.timesLeft--;\n            if (this.timesLeft < 10 && this.timesLeft > 1) {\n                this.schedule(function () {\n                    self.gameApplication.soundManager.playSound(\"clock\");\n                }, 0.5, 2, 0);\n            }\n\n            this.timesNode.active = true;\n            this.timesVal.string = this.timesLeft.toString();\n            if (this.timesLeft < 10) {\n                this.timesVal.node.color = cc.hexToColor(\"#ef3a40\");\n            } else {\n                this.timesVal.node.color = cc.hexToColor(\"#ffffff\");\n            }\n\n            if (this.timesLeft == 0) {\n                this.gameOver = true;\n\n                if (this.gotMoreTime) {\n                    this.timeIsUpNode.active = false;\n                    this.timeIsUpEndNode.active = true;\n                } else {\n\n                    if (SDK().hasVideoAd() || true) {\n                        // console.log(\"_______________1\")\n                        this.timeIsUpNode.active = true;\n                    }\n                    this.timeIsUpEndNode.active = false;\n                }\n\n                this.stopAllAction();\n            }\n        }\n    },\n\n    getMoreTime(event, type) {\n        event.target.getComponent(cc.Button).interactable = false;\n        //看视频\n        if (type == 1) {\n            window.gameApplication.onVideoBtnClick(function (isCompleted) {\n                if (isCompleted) {\n                    this.addTime();\n                    this.timeIsUpNode.active = false;\n                }\n                event.target.getComponent(cc.Button).interactable = true;\n            }.bind(this), false);\n        }\n        //用金币\n        else if (type == 2) {\n            SDK().getItem(\"coins\", function (coin) {\n                if (coin >= 100) {\n                    coin = coin - 100;\n                    SDK().setItem({ coins: coin })\n                    this.addTime();\n\n                } else {\n                    window.gameApplication.showCoinView(function (isCompleted) {\n                        if (isCompleted) {\n                            this.addTime();\n                        }\n                    }.bind(this), false)\n                }\n                event.target.getComponent(cc.Button).interactable = true;\n            }.bind(this))\n        }\n    },\n\n    addTime() {\n        this.timesLeft = 10;\n        this.timesNode.active = true;\n        this.timesVal.string = \"10\"\n\n        var interval = 1;\n        var repeat = 10;\n        var delay = 1;\n\n        this.timeIsUpNode.active = false;\n        this.gotMoreTime = true;\n        this.gameOver = false;\n        this.unschedule(this.timeOutflow);\n        this.schedule(this.timeOutflow, interval, repeat, delay);\n    },\n\n    getMoreTimeInv(event) {\n        var self = this;\n        SDK().getItem(\"all\", function (score) {\n            SDK().share(score, function (isCompleted) {\n                if (isCompleted) {\n                    self.timesLeft = 10;\n                    self.timesNode.active = true;\n                    self.timesVal.string = \"10\"\n\n                    var interval = 1;\n                    var repeat = 10;\n                    var delay = 1;\n\n                    self.gotMoreTime = true;\n                    self.gameOver = false;\n                    self.unschedule(this.timeOutflow);\n                    self.schedule(self.timeOutflow, interval, repeat, delay);\n                } else {\n                    self.showInvAgain(3, event);\n                }\n                event.target.getComponent(cc.Button).interactable = true;\n            }.bind(this));\n        }.bind(this));\n    },\n\n\n\n    restarGame(delay) {\n        this.myRole.node.stopAllActions();\n        this.unschedule(this.timeOutflow);\n        this.timesVal.node.color = cc.hexToColor(\"#ffffff\");\n\n        this.timeIsUpNode.active = false;\n        this.gotMoreTime = false;\n        this.endView.active = false;\n        this.selectedLines.splice(0, this.selectedLines.length);\n        this.enemys.splice(0, this.enemys.length);\n        this.helplines.splice(0, this.helplines.length);\n        this.helpPath.splice(0, this.helpPath.length);\n        this.helpShaked.splice(0, this.helpShaked.length);\n        this.isMoving = false;\n\n\n        //清除当前数据\n        this.movesLeft = this.maxValidMoves;\n        this.moved = 0;\n        this.turnBackCount = 0;\n\n        this.lastDirection = -1;\n\n        if (delay != null && delay > 0) {\n            this.scheduleOnce(function () {\n                this.gameOver = false;\n                this.onyRole = null;\n\t\t\t\t//cc.log(\"#######################-----------find-----------3-1\");\n                this.initGame();\n            }, delay)\n        } else {\n            this.gameOver = false;\n            this.myRole = null;\n\t\t\t//cc.log(\"#######################-----------find-----------3-3\");\n            this.initGame();\n        }\n    },\n\n    //获取步数\n    getSteps() {\n        var lines = [];\n        var helpStart = null;\n        var helpIdx = 0;\n        if (helpStart == null) {\n            helpStart = this.checkXY(this.stepsLines[0], 0, 0);\n            helpIdx = 0;\n        }\n\n        lines.push(cc.v2(helpStart.x, helpStart.y));\n\n        //获得路线\n        var stepCount = 1;\n\n        while (helpIdx < this.stepsLines.length) {\n            var isContinue = true;\n            while (helpIdx < this.stepsLines.length && isContinue) {\n                helpStart = this.checkXY(this.stepsLines[helpIdx], 0, 0);\n                lines.push(cc.v2(helpStart.x, helpStart.y));\n                var hc = this.getCellByCoordinate(helpStart);\n                if (hc) {\n                    var canMove = this.checkCanMoveCount(this.checkMove(helpStart));\n                    if (canMove > 2 && lines.length > 1) {\n                        isContinue = false;\n                        stepCount++;\n                    }\n                }\n                helpIdx++;\n            }\n        }\n\n        //console.log(stepCount);\n        return stepCount;\n    },\n\n    help() {\n        if (this.gameOver || this.myRole == null) {\n            return;\n        }\n        //判断已走的路径有没有途径点（找到起点）\n        if (this.helpPath.length <= 0) {\n            return;\n        }\n\n        var helpStart = null;\n        var helpIdx = 0;\n        if (this.selectedLines.length > 0) {\n            for (var i = this.helpPath.length - 1; i >= 0; i--) {\n                var tmpPath = this.checkXY(this.helpPath[i], 0, 0);\n                var path = cc.v2(tmpPath.x, tmpPath.y);\n                for (var j = this.selectedLines.length - 1; j >= 0; j--) {\n                    var selected = this.selectedLines[j];\n                    if (helpStart == null && path.equals(selected)) {\n                        helpStart = path;\n                        helpIdx = i;\n                        break;\n                    }\n                }\n            }\n        }\n\n        // cc.log(\"helpStart:\",helpStart)\n        if (helpStart == null) {\n            helpStart = this.checkXY(this.helpPath[0], 0, 0);\n            helpIdx = 0;\n        }\n        // cc.log(\"helpStart:\",helpStart)\n\n        this.showHelpLine(helpStart, helpIdx);\n    },\n\n\n    showHelpLine(helpStart, helpIdx) {\n        if (this.helpPath.length <= 0) {\n            return;\n        }\n        // cc.log(\"helpIdx:\",helpIdx);\n\n        var self = this;\n\n        var startV2 = cc.v2(helpStart.x, helpStart.y);\n        // cc.log(\"startV2:\",startV2);\n        if (this.helplines.length > 0) {\n            startV2 = this.helplines[this.helplines.length - 1];\n        }\n\n        //如果startV2已经在heleLines里了，那么从helpLines最后一个节点开始\n        // for(var i = this.helpPath.length-1;i >= 0;i--){\n        for (var i = 0; i < this.helpPath.length; i++) {\n            var v2 = this.helpPath[i];\n            // cc.log(\"__v2:\",v2)\n            if (startV2.equals(v2)) {\n                startV2 = cc.v2(v2.x, v2.y);\n                helpIdx = i;\n                // cc.log(\"edit_startV2:\",startV2);\n                // cc.log(\"__helpIdx:\",helpIdx);\n                break;\n            }\n        }\n        // cc.log(\"this.helpPath.length-1:\",this.helpPath.length-1)\n        if (helpIdx < this.helpPath.length - 1) {\n            this.helpCount--;\n        }\n\n\n        // var helplines = [];\n\n        if (this.helplines.length <= 0) {\n            if (!startV2.equals(this.myRole.axialCoordinate) && Utils.isNeighbors(startV2, this.myRole.axialCoordinate)) {\n                self.helplines.push(cc.v2(this.myRole.axialCoordinate.x, this.myRole.axialCoordinate.y));\n            }\n            self.helplines.push(cc.v2(startV2.x, startV2.y));\n            // cc.log(\"__self.helplines:\",self.helplines);\n        }\n\n        //获得路线\n        var isContinue = true;\n        while (++helpIdx < this.helpPath.length && isContinue) {\n            helpStart = this.checkXY(this.helpPath[helpIdx], 0, 0);\n            self.helplines.push(cc.v2(helpStart.x, helpStart.y));\n            var hc = self.getCellByCoordinate(helpStart);\n            //console.log(\"helpStart:\", helpStart);\n            //console.log(\"hc:\", hc);\n            if (hc) {\n                var canMove = this.checkCanMoveCount(this.checkMove(helpStart));\n                if (canMove > 2 && self.helplines.length > 1 && !hc.isIce && self.helplines.length > self.selectedLines.length) {\n                    isContinue = false;\n                }\n            }\n        }\n\n        // cc.log(\"self.helplines:\",self.helplines);\n        //绘制路线\n        if (self.helplines.length > 1) {\n\n            // for(var i = 0;i < this.allCells.length;i++){\n            //     var hc = this.allCells[i];\n            //     hc.hideHelpLine();\n            // }\n\n            for (var i = 0; i < self.helplines.length; i++) {\n                var tmp_coordinate = self.helplines[i];\n                var hc = self.getCellByCoordinate(tmp_coordinate);\n                if (hc) {\n                    if (i == 0) {\n                        hc.showStartHelp(self.helplines[i + 1]);\n                    } else if (i == self.helplines.length - 1) {\n                        hc.showEndHelp(self.helplines[self.helplines.length - 2]);\n                    } else {\n                        hc.showHelp(self.helplines[i - 1], self.helplines[i + 1]);\n                    }\n\n                }\n            }\n        }\n\n        // cc.log(\"self.helplines:\",self.helplines);\n\n    },\n\n\n    update(dt) {\n        if (this.gameOver) {\n            return;//stop game\n        }\n        // cc.log(\"this.enemys.length:\",this.enemys.length)\n        if (this.enemys.length > 0) {\n\n            //移动\n            for (var i = 0; i < this.enemys.length; i++) {\n                var enemy = this.enemys[i];\n                this.roundMove(enemy);\n            }\n        }\n\n        //炮塔发射子弹\n        if (this.allTowers.length > 0) {\n            for (var i = 0; i < this.allTowers.length; i++) {\n                var tower = this.allTowers[i];\n                this.towerShoot(tower);\n            }\n        }\n\n\n    },\n\n    //炮塔发射子弹\n    towerShoot(tower) {\n        if (!tower.isShooting) {\n            tower.isShooting = true;\n            tower.bubble.active = true;\n            var canMove = this.checkMove(tower.bubbleAxialCoordinate);\n\n            var direction = -1;\n            if ((tower.direction != -1 && canMove[tower.direction])) {\n                direction = tower.direction;\n            }\n\n            if (direction == -1) {\n                // cc.log(\"打到墙了，再往前移动半个格子\",canMove,tower)\n                // var movePlus = this.movePlus[tower.direction];\n                // var hcPos = cc.pCompMult(cc.v2(0.2,0.2),cc.pCompMult(cc.v2(hexTileHeight,hexTileHeight),movePlus));\n                // var a1 = cc.moveBy(tower['s']*0.3*0.3,hcPos.x ,hcPos.y);\n                //cb\n                var cb1 = cc.callFunc(function () {\n                    //播放炸开动画\n                    tower.bubble.getComponent(\"NormalAnimation\").play();\n                }, this);\n                var delay0 = cc.delayTime(1.0);\n\n                var cb2 = cc.callFunc(function () {\n                    //重置\n                    tower.bubbleAxialCoordinate = tower.axialCoordinate;\n                    tower.bubble.position = cc.pCompMult(tower.node.getPosition(), cc.v2(0.5, 0.5));\n                    tower.bubble.opacity = 0;\n                }, this);\n                //TODO，等待多少秒后，再次发射\n                var delay = cc.delayTime(tower['delay']);\n                var cb4 = cc.callFunc(function () {\n                    //重置\n                    tower.isShooting = false;\n                    tower.bubble.opacity = 255;\n                }, this);\n\n                var seq = cc.sequence(cb1, delay0, cb2, delay, cb4);\n                tower.bubble.runAction(seq);\n            } else {\n                // cc.log(\"hexTileHeight:\",hexTileHeight)\n                // var scale = hexTileHeight;\n                var scale = hexTileHeight / 100;\n\n                var nextPos = tower.bubbleAxialCoordinate.add(this.movePlus[direction]);\n                var hc = this.getCellByCoordinate(nextPos);\n\n                // cc.log(\"nextPos\",nextPos);\n                // var hcPos = tower.bubble.getPosition();\n                // var movePlus = this.movePlus[direction];\n                // hcPos = hcPos.add(cc.pCompMult(cc.v2(hexTileHeight,hexTileHeight),nextPos));\n                //  cc.log(\"_______movePlus:\",cc.pCompMult(cc.v2(hexTileHeight,hexTileHeight),movePlus))\n\n                // var hcPos = cc.pCompMult(cc.v2(hexTileHeight,hexTileHeight),this.movePlus[direction]);\n                // var hcPos = tower.bubble.convertToNodeSpaceAR(worldPosition);\n\n                let worldPosition = this.tileBox.convertToWorldSpaceAR(hc.node.getPosition());\n                var hcPos_tmp = tower.node.convertToNodeSpaceAR(worldPosition);\n\n                var hcPos;\n                // hcPos = hc.node.convertToWorldSpaceAR(hcPos)\n                // hcPos = tower.bubble.convertToNodeSpaceAR(hcPos);\n                // cc.log(\"++++++++++++worldPosition:\",worldPosition)\n                // cc.log(\"++++++++++++hcPos:\",hcPos)\n                // cc.log(\"direction:\",direction)\n\n                if (direction == 1) {\n                    hcPos = cc.v2(hcPos_tmp.y * -1, hcPos_tmp.x * -1);\n                } else if (direction == 2) {\n                    hcPos = cc.v2(hcPos_tmp.x * -1, hcPos_tmp.y * -1);\n                } else if (direction == 3) {\n                    hcPos = cc.v2(hcPos_tmp.y, hcPos_tmp.x);\n                } else {\n                    hcPos = cc.v2(hcPos_tmp.x, hcPos_tmp.y);\n                }\n\n                var a1 = cc.moveTo(tower['s'] * 0.3, hcPos.y, hcPos.x);\n                //cb\n                var cb1 = cc.callFunc(function () {\n                    //更新位置\n                    tower.bubbleAxialCoordinate = nextPos;\n                    tower.isShooting = false;\n                }, this);\n\n                var seq = cc.sequence(a1, cb1);\n                tower.bubble.runAction(seq);\n\n            }\n        }\n    },\n\n    //怪物自动移动\n    roundMove(enemy) {\n        if (!enemy.isMoving) {\n            enemy.isMoving = true;\n            var canMove = this.checkMove(enemy.axialCoordinate);\n\n            var direction = -1;\n\n            if ((enemy.direction != -1 && canMove[enemy.direction] && this.checkMoveDirectionCount(canMove, enemy.direction) == 1) || (enemy.direction != -1 && canMove[enemy.direction] && Math.random() > 0.6)) {\n                direction = enemy.direction;\n            } else {\n                while (direction == -1) {\n                    var idx = Utils.GetRandomNum(0, 3);\n                    if (canMove[idx]) {\n                        direction = idx;\n                    }\n                }\n            }\n\n            enemy.direction = direction;\n\n            var nextPos = enemy.axialCoordinate.add(this.movePlus[direction]);\n            var hc = this.getCellByCoordinate(nextPos);\n\n            var hcPos = hc.node.getPosition();\n            var a1 = cc.moveTo(1, hcPos.x, hcPos.y);\n            //cb\n            var cb1 = cc.callFunc(function () {\n\n                //更新位置\n                enemy.axialCoordinate = nextPos;\n                enemy.isMoving = false;\n            }, this);\n\n            var seq = cc.sequence(a1, cb1);\n            enemy.node.runAction(seq);\n        }\n\n    },\n\n    /**\n     * 当屏幕点击\n    */\n    onMouseDown(event) {\n        if (this.gameOver || this.myRole == null) {\n            return;\n        }\n        this.mouseIsDown = true;\n        this.touchPos = this.tileBox.convertToNodeSpaceAR(event.getLocation());\n    },\n\n    onMouseMove(event) {\n        if (this.gameOver || this.myRole == null) {\n            return;\n        }\n        if (this.mouseIsDown) {\n            var movePos = this.tileBox.convertToNodeSpaceAR(event.getLocation());\n\n            var offsetX = movePos.x - this.touchPos.x;\n            var offsetY = movePos.y - this.touchPos.y;\n\n            if (Math.abs(offsetX) < 30 && Math.abs(offsetY) < 30) {\n                return;\n            }\n\n            //根据X方向与Y方向的偏移量大小的判断  \n            if (Math.abs(offsetX) > Math.abs(offsetY)) {\n                if (offsetX < 0) {\n                    // cc.log(\"左\")\n                    this.doAction(1, true);   //左\n                }\n                else {\n                    // cc.log(\"右\")\n                    this.doAction(3, true);   //右边\n                }\n            }\n            else {\n                if (offsetY > 0) {\n                    this.doAction(0, true);   //上\n                }\n                else {\n                    this.doAction(2, true);//下\n                }\n            }\n\n            this.mouseIsDown = false;\n        }\n    },\n\n\n    getCellByCoordinate(_coordinate) {\n        for (var i = 0; i < this.allCells.length; i++) {\n            var hc = this.allCells[i];\n            if (hc.axialCoordinate.equals(_coordinate)) {\n                return hc;\n            }\n        }\n        return null;\n    },\n\n    stopAllAction() {\n        cc.log(\"stopAllAction\")\n    },\n\n    die() {\n        this.isinigame =false;\n        this.unschedule(this.timeOutflow);\n        this.gameOver = true;\n\n        //播放死亡动画\n        this.myRole.playDie();\n        this.gameApplication.soundManager.playSound(\"error\");\n        this.scheduleOnce(function () {\n            this.gameApplication.openMainView();\n        }.bind(this), 1)\n    },\n\n    showGameOver() {\n        //游戏结束\n        // D.sdk.showBanner();\n        // D.sdk.recorderStop();\n        this.isinigame =false;\n        //预加载下一关\n        if (bid != null && bid > 0 && mid != null && mid > 0 && lid != null && lid > 0) {\n            var arr = [];\n            if (lid < 100) {\n                arr.push(lid + 1);\n            }\n            arr.forEach(function (tmp_lid) {\n                var tmp_path = \"conf/level_detail/b_\" + bid + \"/\" + mid + \"/\" + tmp_lid;\n                window.gameApplication.getConf(tmp_path, null);\n            });\n        }\n\n        this.gameApplication.soundManager.playSound(\"gamewin\");\n\n        this.unschedule(this.timeOutflow);\n        this.timeIsUpNode.active = false;\n\n        // cc.log(\"_______________showGameOver\");\n        var self = this;\n        this.gameOver = true;\n        this.endView.active = true;\n\n        this.stopAllAction();\n\n        var curr_star = 0;\n\n        if (this.turnBackCount <= 0) {\n            curr_star = 3;\n        } else if (this.turnBackCount <= 6) {\n            curr_star = 2;\n        } else {\n            curr_star = 1;\n        }\n\n        if (curr_star == 3) {\n            this.endView_title.string = \"很棒\";\n        } else if (curr_star == 2) {\n            this.endView_title.string = \"很好\";\n        } else {\n            this.endView_title.string = \"清除\";\n        }\n        this.endView_title.string = \"完成\";\n\n        this.endView_text.string = \"您一共走了 \" + this.moved + \" 步\";\n        this.giftBtn.active = true;\n\n\n        //最好成绩\n        SDK().getItem(bid + \"_\" + mid + \"_\" + lid, function (star) {\n            //console.log(bid + \"_\" + mid + \"_\" + lid)\n            //设置最后玩的关卡\n            SDK().getItem(\"curIdx\", function (idx) {\n                var curIdx = this.judgeIdx(mid, lid);\n                //console.log(curIdx)\n                if (curIdx + 1 > idx) {\n                    var param = {};\n                    window.curIdx = curIdx + 1;\n                    param.curIdx = window.curIdx;\n                    SDK().setItem(param, function () {\n                        window.mainScirpt.initStage(window.curIdx);\n                    }.bind(this));\n                }\n            }.bind(this))\n\n            //如果当前星星大于历史最高，那么保存\n            if (star < 1) {\n                var param = {};\n                param[bid + \"_\" + mid + \"_\" + lid] = 1;\n                var saveCount = 0;\n                SDK().setItem(param, function () {\n                    saveCount++;\n                    if (saveCount >= 2) {\n                        this.scheduleOnce(function () {\n                            //this.endView.active = false;\n                            var curIdx = this.judgeIdx(mid, lid);\n                            window.mainScirpt.initStage(curIdx);\n                            //this.gameApplication.openMainView(true);\n                            if (curIdx % 10 == 0 && curIdx != 0) {\n                                window.timeGiftScript.showTimeGiftView(2);\n                            }\n                        }.bind(this), 1)\n                    }\n                }.bind(this));\n\n                //保存个人星星\n                var plusStar = curr_star - star;\n                SDK().getItem(\"all\", function (score) {\n                    score += 1;\n                    SDK().setRankScore(2, score, \"{}\", null);\n                    SDK().setItem({ all: score }, function () {\n                        saveCount++;\n                        if (saveCount >= 2) {\n                            this.scheduleOnce(function () {\n                                //this.endView.active = false;\n                                var curIdx = this.judgeIdx(mid, lid);\n                                window.mainScirpt.initStage(curIdx);\n                                //this.gameApplication.openMainView(true);\n                                if (curIdx % 10 == 0 && curIdx != 0) {\n                                    window.timeGiftScript.showTimeGiftView(2);\n                                }\n                            }.bind(this), 1)\n                        }\n                    }.bind(this));\n                }.bind(this));\n\n                //保存mid关卡的星星\n                SDK().getItem(bid + \"_\" + mid, function (score) {\n                    score += 1;\n                    var param = {};\n                    param[bid + \"_\" + mid] = score;\n                    SDK().setItem(param, null);\n                }.bind(this));\n            } else {\n                this.scheduleOnce(function () {\n                    //this.endView.active = false;\n                    //this.gameApplication.openMainView();\n                }.bind(this), 1)\n            }\n        }.bind(this));\n\n\n        SDK().getItem(bid + \"_\" + mid + \"_\" + lid + \"_moves\", function (best) {\n            if (self.moved < best || best <= 0) {\n                //保存历史最小步数\n                var param = {};\n                param[bid + \"_\" + mid + \"_\" + lid + \"_moves\"] = self.moved;\n                SDK().setItem(param, null);\n            }\n        }.bind(this));\n\n        this.gameApplication.playTimes++;\n    },\n\n\n    StartRecourd(){\n        // D.sdk.showShare('',function(){\n        //     backToMain();\n        // },true);\n    },\n\n    backToMain(){\n        this.endView.active = false;\n        this.gameApplication.openMainView();\n    },\n\n    //判断所在关卡\n    judgeIdx(mid, lid) {\n        var idx = 0;\n        if (lid >= 50) {\n            lid = lid - 50;\n            idx = 300;\n            idx = idx + ((mid - 1) * 10) + (Math.floor((lid - 1) / 10) * 50) + lid % 10;\n        } else {\n            idx = ((mid - 1) * 10) + (Math.floor((lid - 1) / 10) * 60) + (lid - 1) % 10;\n        }\n        return idx;\n    },\n\n    onOpAdClicked() {\n        if (this.opad_game_id != null) {\n            SDK().switchGameAsync(this.opad_game_id);\n        }\n        // SDK().onOpAdBtnClicked();\n    },\n\n\n    checkWin() {\n        var isWin = this.myRole.axialCoordinate.equals(this.endObj.axialCoordinate);\n        if (isWin) {\n            this.isinigame =false;\n            // cc.log(\"到达终点，游戏结束\");\n            this.showGameOver();\n        }\n        return isWin;\n    },\n\n    moveEnd() {\n        this.isMoving = false;\n\n\n        //检查胜利\n        if (!this.checkWin()) {\n            var canMove = this.checkMove();\n            this.gameApplication.soundManager.playSound(\"done\");\n\n            //检查当前是否在冰上，并且前方可以走\n            var hc = this.getCellByCoordinate(this.myRole.axialCoordinate);\n            if (hc.isIce && canMove[this.lastDirection]) {\n                //继续行走\n                this.doAction(this.lastDirection, true);\n            } else {\n                //检查箭头\n                this.moved++;\n                this.movesLeft--;\n                if (this.turnBackCount > 0 && this.turnBackCount % 2 == 0 && !Utils.inArray(this.turnBackCount, this.helpShaked)) {\n                    this.helpBtnShake();\n                    this.helpShaked.push(this.turnBackCount);\n                }\n                this.myRole.setArrow(canMove[0], canMove[1], canMove[2], canMove[3]);\n            }\n        }\n\n        this.updateUI();\n    },\n\n    addSelectedLines(coordinate) {\n        var self = this;\n        if (this.selectedLines.length >= 2 && coordinate.equals(this.selectedLines[this.selectedLines.length - 2])) {\n            var tmp_coordinate = this.selectedLines.pop();\n            var hc = this.getCellByCoordinate(tmp_coordinate);\n            hc.hideLine();\n\n        } else {\n            this.selectedLines.push(cc.v2(coordinate.x, coordinate.y));\n        }\n\n        if (this.selectedLines.length > 1) {\n\n            this.scheduleOnce(function () {\n                //绘制路线\n                for (var i = 0; i <= self.selectedLines.length - 1; i++) {\n                    var tmp_coordinate = self.selectedLines[i];\n                    var hc = self.getCellByCoordinate(tmp_coordinate);\n                    hc.hideLine();\n                }\n                for (var i = 0; i <= self.selectedLines.length - 1; i++) {\n                    var tmp_coordinate = self.selectedLines[i];\n                    var hc = self.getCellByCoordinate(tmp_coordinate);\n                    if (i == 0) {\n                        hc.showStartLine(self.selectedLines[i + 1]);\n                    } else if (i == self.selectedLines.length - 1) {\n                        hc.showEndLine(self.selectedLines[self.selectedLines.length - 2]);\n                    } else {\n                        hc.showLine(self.selectedLines[i - 1], self.selectedLines[i + 1]);\n                    }\n                }\n            }, 0.08)\n\n\n        }\n\n    },\n\n    //移动\n    doAction(direction, manual) {\n        if (this.isMoving || this.gameOver) {\n            return;\n        }\n\n        this.isMoving = true;\n        this.myRole.hideArrow();\n        var self = this;\n        var canMove = this.checkMove();\n\n        if (!manual && this.checkMoveDirectionCount(canMove, direction) > 1) {\n            //遇到路口停止\n            // cc.log(\"遇到路口停止\",this.checkMoveDirectionCount(canMove,direction))\n            this.moveEnd();\n            return;\n        }\n\n        if (canMove[direction]) {\n            var nextPos = this.myRole.axialCoordinate.add(this.movePlus[direction]);\n            var hc = this.getCellByCoordinate(nextPos);\n\n            // cc.log(\"可以移动到\",nextPos)\n            if (hc != null) {\n\n                //检查是否走回头路\n                var isTurnBack = false;\n                if (direction == 0) {\n\n                    isTurnBack = this.lastDirection == 2;\n                } else if (direction == 3) {\n                    isTurnBack = this.lastDirection == 1;\n                } else if (direction == 1) {\n\n                    isTurnBack = this.lastDirection == 3;\n                } else {\n                    isTurnBack = this.lastDirection == 0;\n                }\n                if (isTurnBack) {\n                    this.turnBackCount++;\n                }\n\n\n                this.lastDirection = direction;\n\n                var hcPos = hc.node.getPosition();\n                var a1 = cc.moveTo(0.12, hcPos.x, hcPos.y);\n                //cb\n                var cb1 = cc.callFunc(function () {\n\n                    //更新位置\n                    self.myRole.axialCoordinate = nextPos;\n                    self.isMoving = false;\n                    if (!self.checkWin()) {\n                        self.doAction(direction, false);\n                    }\n                }, this);\n\n                //路线\n                this.addSelectedLines(nextPos);\n\n                var seq = cc.sequence(a1, cb1);\n                self.myRole.node.runAction(seq);\n            }\n\n        } else {\n            this.gameApplication.soundManager.playSound(\"done\");\n\n            if (this.checkMoveDirectionCount(canMove, direction) == 1) {\n                direction = this.getkMoveDirection(canMove, direction);\n                // cc.log(\"遇到路口，但只有一个路径。改变路径：\",direction)   \n                if (!this.checkWin()) {\n                    var hc = this.getCellByCoordinate(this.myRole.axialCoordinate);\n                    if (!hc.isIce) {\n                        this.isMoving = false;\n                        self.doAction(direction, true);\n                    } else {\n                        this.moveEnd();\n                    }\n                }\n            } else {\n                // cc.log(\"不能移动\",direction)    \n                this.moveEnd();\n            }\n        }\n    },\n\n    //获取唯一可以移动的路径\n    getkMoveDirection(canMove, direction) {\n        var c;\n        //t,l,d,r\n        if (direction == 0) {\n            c = 2;\n        } else if (direction == 3) {\n            c = 1;\n        } else if (direction == 1) {\n            c = 3;\n        } else {\n            c = 0;\n        }\n        var count = 0;\n        for (var i = 0; i < canMove.length; i++) {\n            var v = canMove[i];\n            if (v && i != c)\n                return i;\n        };\n    },\n\n    checkCanMoveCount(canMove) {\n        var c;\n        var count = 0;\n        for (var i = 0; i < canMove.length; i++) {\n            var v = canMove[i];\n            if (v)\n                count++;\n        };\n        return count;\n    },\n\n\n    //获取可以移动的方向，不算direction的反方向\n    checkMoveDirectionCount(canMove, direction) {\n        var c;\n        //t,l,d,r\n        if (direction == 0) {\n            c = 2;\n        } else if (direction == 3) {\n            c = 1;\n        } else if (direction == 1) {\n            c = 3;\n        } else {\n            c = 0;\n        }\n        var count = 0;\n        for (var i = 0; i < canMove.length; i++) {\n            var v = canMove[i];\n            if (v && i != c)\n                count++;\n        };\n        return count;\n    },\n\n    //检查可以移动的方向\n    checkMove(axialCoordinate) {\n        if (axialCoordinate == null) {\n            axialCoordinate = this.myRole.axialCoordinate;\n        }\n\n        var neighbors = Utils.getNeighborsOBJ(axialCoordinate);\n        var t = true, l = true, d = true, r = true;\n\n        var hc = this.getCellByCoordinate(axialCoordinate);\n        if (hc != null) {\n            if (hc.leftActive) {\n                l = false;\n            }\n            if (hc.rightActive) {\n                r = false;\n            }\n            if (hc.topActive) {\n                t = false;\n            }\n            if (hc.bottomActive) {\n                d = false;\n            }\n        }\n\n        if (t) {\n            var tc = this.getCellByCoordinate(neighbors.t);\n            if (tc != null && tc.bottomActive) {\n                t = false;\n            }\n        }\n\n        if (d) {\n            var dc = this.getCellByCoordinate(neighbors.b);\n            if (dc != null && dc.topActive) {\n                d = false;\n            }\n        }\n\n        if (l) {\n            var lc = this.getCellByCoordinate(neighbors.l);\n            if (lc != null && lc.rightActive) {\n                l = false;\n            }\n        }\n\n        if (r) {\n            var rc = this.getCellByCoordinate(neighbors.r);\n            if (rc != null && rc.leftActive) {\n                r = false;\n            }\n        }\n\n        return [t, l, d, r]\n\n\n    },\n\n    checkMovePos(axialCoordinate) {\n        if (axialCoordinate == null) {\n            axialCoordinate = this.myRole.axialCoordinate;\n        }\n\n        var neighbors = Utils.getNeighborsOBJ(axialCoordinate);\n        var t = neighbors.t, l = neighbors.l, d = neighbors.b, r = neighbors.r;\n\n        var hc = this.getCellByCoordinate(axialCoordinate);\n        if (hc != null) {\n            if (hc.leftActive) {\n                l = cc.v2(-1, -1);\n            }\n            if (hc.rightActive) {\n                r = cc.v2(-1, -1);\n            }\n            if (hc.topActive) {\n                t = cc.v2(-1, -1);\n            }\n            if (hc.bottomActive) {\n                d = cc.v2(-1, -1);\n            }\n        }\n\n        if (t) {\n            var tc = this.getCellByCoordinate(neighbors.t);\n            if (tc != null && tc.bottomActive) {\n                t = cc.v2(-1, -1);\n            }\n        }\n\n        if (d) {\n            var dc = this.getCellByCoordinate(neighbors.b);\n            if (dc != null && dc.topActive) {\n                d = cc.v2(-1, -1);\n            }\n        }\n\n        if (l) {\n            var lc = this.getCellByCoordinate(neighbors.l);\n            if (lc != null && lc.rightActive) {\n                l = cc.v2(-1, -1);\n            }\n        }\n\n        if (r) {\n            var rc = this.getCellByCoordinate(neighbors.r);\n            if (rc != null && rc.leftActive) {\n                r = cc.v2(-1, -1);\n            }\n        }\n\n        return [t, l, d, r]\n\n\n    },\n\n    createEnemy(enemys) {\n        var scale = hexTileHeight / 100;\n\n        if (enemys.length <= 0) {\n            return;\n        }\n\n        for (var i = 0; i < enemys.length; i++) {\n            var enemy = enemys[i];\n            var hc = this.getCellByCoordinate(cc.v2(enemy.x, enemy.y));\n\n            var enemy_GO;\n            var random = Math.random();\n            if (random < 0.33) {\n                enemy_GO = cc.instantiate(this.enemyPrefab);\n            } else if (random < 0.66) {\n                enemy_GO = cc.instantiate(this.enemyPrefab1);\n            } else {\n                enemy_GO = cc.instantiate(this.enemyPrefab2);\n            }\n            enemy_GO.parent = this.tileBox;\n            enemy_GO.setScale(scale);\n            enemy_GO.setPosition(hc.node.getPosition());\n            enemy_GO.active = true;\n\n            //auto color colors\n            // enemy_GO.getChildByName(\"enemy\").color = cc.hexToColor(colors[Utils.GetRandomNum(0,colors.length-1)]);\n\n            var enemy = enemy_GO.getComponent(Enemy);\n            enemy.axialCoordinate = hc.axialCoordinate;\n            this.enemys.push(enemy);\n        }\n    },\n\n    createRole(start, end) {\n        var scale = hexTileHeight / 100;\n\n        start = this.checkXY(start, 0, 0);\n        end = this.checkXY(end, 0, 0);\n\n        var hc = this.getCellByCoordinate(cc.v2(start.x, start.y));\n        var hc1 = this.getCellByCoordinate(cc.v2(end.x, end.y));\n\n        var role_GO = cc.instantiate(this.rolePrefab);\n      //  cc.log(\"#######################-----------find-----------1\");\n        role_GO.parent = this.tileBox;\n        role_GO.setScale(scale);\n        role_GO.setPosition(hc.node.getPosition());\n        role_GO.active = true;\n\n        var role = role_GO.getComponent(Role);\n        this.myRole = role;\n        this.myRole.init();\n        this.myRole.axialCoordinate = hc.axialCoordinate;\n        this.selectedLines.push(cc.v2(hc.axialCoordinate.x, hc.axialCoordinate.y));\n        var canMove = this.checkMove();\n        this.myRole.setArrow(canMove[0], canMove[1], canMove[2], canMove[3]);\n\n        var end_GO = cc.instantiate(this.endPrefab);\n        end_GO.parent = this.tileBox;\n        end_GO.setScale(scale);\n        end_GO.setPosition(hc1.node.getPosition());\n        end_GO.active = true;\n        this.endNode = end_GO;\n\n        var endObj = end_GO.getComponent(Role);\n        this.endObj = endObj;\n        this.endObj.axialCoordinate = hc1.axialCoordinate;\n\n        this.myRole.gameView = this;\n        this.myRole.setDark(mid == 4);\n\n    },\n\n    //发送碰撞即死亡\n    collisionCallback() {\n        // cc.log(this)\n        this.die();\n    },\n\n    //初始化格子\n    createGrid(_levelDimensions, walls, ices, towers, cb) {\n        this.gridOffset.x = 0;\n        this.gridOffset.y = 0;\n        var maxL = Math.max(_levelDimensions.x, _levelDimensions.y);\n        // cc.log (\"maxL:\" + maxL);\n        var winSize = cc.winSize;\n        var tileBoxSize = this.tileBox.getContentSize();\n        var tileBoxHeight = tileBoxSize.height;\n        var hexH = winSize.width;\n        hexTileHeight = (hexH - (lineWidth - lineWidth * _levelDimensions.x)) / _levelDimensions.x;\n        // cc.log(\"hexTileHeight:\",hexTileHeight);\n\n        var nowHeight = (hexTileHeight * _levelDimensions.y);\n\n        // cc.log(\"hexTileHeight:\",hexTileHeight);\n        // cc.log(\"tileBoxHeight:\",tileBoxHeight);\n        // cc.log(\"nowHeight:\",nowHeight);\n        // 1065    1335.1789638932496\n        if (tileBoxHeight < nowHeight) {\n            hexH = tileBoxSize.height;\n            var testHexTileHeight = (hexH - (lineWidth - lineWidth * _levelDimensions.y)) / _levelDimensions.y;\n            // cc.log(\"testHexTileHeight:\",testHexTileHeight);\n            if (testHexTileHeight < hexTileHeight) {\n                hexTileHeight = testHexTileHeight;\n                this.gridOffset.x = (winSize.width - (_levelDimensions.x * hexTileHeight) + _levelDimensions.x * lineWidth) * 0.5;\n            }\n            // cc.log(\"hexTileHeight:\",hexTileHeight);\n            // cc.log(\"winSize.width:\",winSize.width);\n            // cc.log(\"this.levelDimensions.x:\",this.levelDimensions.x);\n            // cc.log(\"this.levelDimensions.x * hexTileHeight:\",this.levelDimensions.x * hexTileHeight);\n\n        }\n\n        // cc.log(\"tileBox:\",this.tileBox.getContentSize());\n\n        sideLength = hexTileHeight;\n        // cc.log (\"sideLength:\" + sideLength);\n\n        var sizeW = sideLength;\n        var sizeH = sideLength;\n\n        this.levelDimensions = _levelDimensions;\n\n        var hexTile;\n        var hc;\n        var axialPoint = cc.v2(0, 0);\n        var screenPoint = cc.v2(0, 0);\n\n        var test = (tileBoxSize.height - (this.levelDimensions.y * hexTileHeight) + this.levelDimensions.y * lineWidth) * 0.5\n        this.gridOffset.y = (tileBoxSize.height * -1) + test;\n\n        //loop through the rows & columns \n\n        for (var i = 0; i < this.levelDimensions.x; i++) {\n            for (var j = 0; j < this.levelDimensions.y; j++) {\n                axialPoint.x = i;\n                axialPoint.y = j;\n                // cc.log(\"axialPoint:\",axialPoint);\n                //convert offset points to axial points\n                // axialPoint = Utils.offsetToAxial(axialPoint);\n                // cc.log(\"axialPoint:\",axialPoint);\n\n                //convert axial points to screen points\n                screenPoint = Utils.axialToScreen(axialPoint, sideLength);\n                // cc.log (\"screenPoint:\" ,screenPoint);\n                //add the grid offset value to position the grid\n                screenPoint.x += this.gridOffset.x;\n                screenPoint.y += this.gridOffset.y;\n\n                // cc.log (\"screenPoint:\" + screenPoint.x+\"___\"+screenPoint.y);\n                //place new hextile\n                hexTile = cc.instantiate(this.hexCellPrefab);\n                hexTile.parent = this.tileBox;\n\n                hexTile.setPosition(screenPoint.add(cc.v2(0, 1000)));\n                hexTile.setContentSize(cc.size(sizeW, sizeW));\n                hexTile.active = true;\n\n                var self = this;\n                if (j % 2 == 0) {\n                    hexTile.runAction(cc.sequence(\n                        cc.moveTo(0.2 + (0.05 * axialPoint.y), screenPoint.x, screenPoint.y),\n                        cc.callFunc(function () {\n                            self.gameApplication.soundManager.playSound(\"uplock\");\n                        })\n                    ));\n                    // hexTile.runAction(cc.moveTo(0.2+(0.05*axialPoint.y), screenPoint.x,screenPoint.y));\n                } else {\n                    hexTile.runAction(cc.moveTo(0.2 + (0.05 * axialPoint.y), screenPoint.x, screenPoint.y));\n                }\n\n\n\n                //we will identify hextile by name\n                hexTile.name = \"grid\" + i.toString() + \"_\" + j.toString();\n                hexTile.zIndex = 0;\n\n                hc = hexTile.getComponent(HexCell);\n                hc.scaleChild(sizeW / 100, sizeW / 100);\n\n                // //store the converted axial coordinate inside the hexcell for easier reference\n                hc.axialCoordinate = axialPoint;\n                // //add to the list\n                this.allCells.push(hc);\n            }\n        }\n\n        if (walls == null || walls.length <= 0) {\n            return;\n        }\n\n        var self = this;\n        var wx = 0, wy = 0, dx = 0, dy = 0;\n        for (var i = 0; i < walls.length; i++) {\n            // for(var i =0;i<20;i++){\n            var wall = walls[i];\n            var tmp_w1 = self.checkXY(wall['w1'], wx, wy);\n            var tmp_d1 = self.checkXY(wall['d1'], dx, dy);\n            var w1;\n            var d1;\n\n            // dx = d1.x;\n            // dy = d1.y; \n            // cc.log(\"w1:\",w1);\n            // cc.log(\"w1-x:\"+tmp_w1.x+\",w1-y:\"+tmp_w1.y+\"_____d1-x:\"+tmp_d1.x+\",d1-y:\"+tmp_d1.y);\n            //设置\n            var hc;\n            if (tmp_w1.x < tmp_d1.x || tmp_w1.y > tmp_d1.y) {\n                w1 = tmp_w1;\n                d1 = tmp_d1;\n            } else {\n                w1 = tmp_d1;\n                d1 = tmp_w1;\n            }\n\n            if (hc = this.getCellByCoordinate(cc.v2(w1.x, w1.y - 1))) {\n                if (w1.x == d1.x) {\n                    //画竖线\n                    // cc.log(\"setLeft\")\n                    hc.setLeft(true);\n                } else {\n                    // cc.log(\"setTop\")\n                    hc.setTop(true);\n\n                }\n            } else if (hc = this.getCellByCoordinate(cc.v2(w1.x, w1.y))) {\n                if (w1.x == d1.x) {\n                    // cc.log(\"setRight\")       \n                    hc.setRight(true);\n                } else {\n                    // cc.log(\"setBottom\")       \n                    hc.setBottom(true);\n\n                }\n            } else if (hc = this.getCellByCoordinate(cc.v2(w1.x - 1, w1.y - 1))) {\n                // cc.log(\"hchchchchc\",hc)\n                if (w1.x == d1.x) {\n                    // cc.log(\"seRight\")       \n                    hc.setRight(true);\n                } else {\n                    // cc.log(\"setBottom\")       \n                    hc.setBottom(true);\n\n                }\n            }\n        };\n\n        //播放动画\n        this.scheduleOnce(function () {\n\n            this.scheduleOnce(function () {\n                if (ices != null && ices.length > 0) {\n                    for (var i = 0; i < ices.length; i++) {\n                        var ice = ices[i];\n                        var hc = this.getCellByCoordinate(cc.v2(ice.x, ice.y));\n\n                        if (hc != null) {\n                            hc.setIce(true);\n                            var iceNode = cc.instantiate(this.icePrefab);\n                            iceNode.parent = this.iceBox;\n\n                            iceNode.setPosition(hc.node.getPosition());\n                            iceNode.setContentSize(hc.node.getContentSize());\n                            iceNode.active = true;\n\n                            iceNode.setScale(0.3, 0.3);\n                            iceNode.runAction(cc.scaleTo(0.35, 1, 1))\n                        }\n                    }\n                }\n            }.bind(this),1)\n\n\n            // cc.log(\"towers:\",towers)\n            if (towers != null && towers.length > 0) {\n                for (var i = 0; i < towers.length; i++) {\n                    var tower = towers[i];\n                    // cc.log(\"tower:\",tower)\n\n\n                    var tmp_w1 = self.checkXY(tower['w1'], wx, wy);\n                    var tmp_d1 = self.checkXY(tower['d1'], dx, dy);\n                    var w1;\n                    var d1;\n\n                    // dx = d1.x;\n                    // dy = d1.y; \n                    // cc.log(\"w1:\",w1);\n                    //设置\n                    var hc = null;\n                    if (tmp_w1.x < tmp_d1.x || tmp_w1.y > tmp_d1.y) {\n                        w1 = tmp_w1;\n                        d1 = tmp_d1;\n                    } else {\n                        w1 = tmp_d1;\n                        d1 = tmp_w1;\n                    }\n\n                    // cc.log(\"w1-x:\"+tmp_w1.x+\",w1-y:\"+tmp_w1.y+\"_____d1-x:\"+tmp_d1.x+\",d1-y:\"+tmp_d1.y);\n\n                    if (tower['direction'] == 1) {\n                        hc = this.getCellByCoordinate(cc.v2(Math.max(w1.x, d1.x) - 1, d1.y));\n                        if (hc == null) {\n                            hc = this.getCellByCoordinate(cc.v2(Math.max(w1.x, d1.x), d1.y));\n                        }\n                    }\n                    else if (tower['direction'] == 3) {\n                        hc = this.getCellByCoordinate(cc.v2(Math.max(w1.x, d1.x), d1.y));\n                        if (hc == null) {\n                            hc = this.getCellByCoordinate(cc.v2(Math.max(w1.x, d1.x) - 1, d1.y));\n                        }\n                    }\n                    else if (tower['direction'] == 0) {\n                        hc = this.getCellByCoordinate(cc.v2(w1.x, Math.min(w1.y, d1.y)));\n                        if (hc == null) {\n                            hc = this.getCellByCoordinate(cc.v2(w1.x, Math.max(w1.y, d1.y)));\n                        }\n                    }\n                    else if (tower['direction'] == 2) {\n                        hc = this.getCellByCoordinate(cc.v2(w1.x, Math.max(w1.y, d1.y) - 1));\n                        if (hc == null) {\n                            hc = this.getCellByCoordinate(cc.v2(w1.x, Math.max(w1.y, d1.y)));\n                        }\n                    }\n\n                    if (hc != null) {\n                        if (w1.x == d1.x) {\n                            //画竖线\n                            if (tower['direction'] == 1) {\n                                hc.setRightTower(true);\n                                this.pushTower(hc.rightTower, hc.axialCoordinate, tower);\n                            } else {\n                                hc.setLeftTower(true);\n                                this.pushTower(hc.leftTower, hc.axialCoordinate, tower);\n                            }\n                        } else {\n                            if (tower['direction'] == 0) {\n                                hc.setTopTower(true);\n                                this.pushTower(hc.topTower, hc.axialCoordinate, tower);\n                            } else {\n                                hc.setBottomTower(true);\n                                this.pushTower(hc.bottomTower, hc.axialCoordinate, tower);\n                            }\n                        }\n\n                        hc.node.zIndex = 1;\n                    }\n                }\n            }\n\n            if (cb) {\n                cb();\n            }\n        }.bind(this), 0.5 + (0.05 * this.levelDimensions.y));\n    },\n\n    //将tower push到this.allTowers\n    pushTower(node, axialCoordinate, config) {\n        var tower = node.getComponent(Tower);\n        tower.axialCoordinate = axialCoordinate;\n        tower.init(config);\n        this.allTowers.push(tower)\n    },\n\n\n    checkXY(dict, x, y) {\n        // if(dict['x'] == null && dict['y'] == null){\n        //     return null;\n        // }\n        // cc.log(\"dict:\",dict);\n        if (dict['x'] == null) {\n            dict['x'] = y;\n        }\n        if (dict['y'] == null) {\n            dict['y'] = x;\n        }\n\n        return dict;\n    },\n\n    updateUI() {\n\n        // JsonObject act = new JsonObject() { \n        //     { \"type\", \"updateUI\" },\n        // };\n        // DoLuaAction (act.ToString());\n\n        //\n        this.moves.string = this.movesLeft + \"/\" + this.maxValidMoves;\n        if (this.movesLeft <= 0 && mid == 1) {\n            this.gameOver = true;\n            window.gameApplication.showStepView(function (isOk) {\n                if (isOk) {\n                    this.gameOver = false;\n                    this.movesLeft = 5;\n                    this.updateUI();\n                } else {\n                    this.isinigame =false;\n                    this.gameApplication.openMainView();\n                }\n            }.bind(this), false)\n        }\n    },\n\n    setStar(node, score, f) {\n        // var isFill = score >= f;\n        // node.getChildByName(\"empty\").active = !isFill;\n        // node.getChildByName(\"fill\").active = isFill;\n    },\n\n    onBackBtnClicked(event) {\n        this.isinigame =false;\n        if (this.gameApplication != null) {\n            this.gameApplication.soundManager.playSound(\"btn_click\");\n        }\n\n        this.gameApplication.openMainView();\n        //D.sdk.showBanner();\n    },\n\n    onNextBtnClicked(event) {\n        var btn = event.target.getComponent(cc.Button);\n        btn.interactable = false;\n        this.scheduleOnce(function () {\n            btn.interactable = true;\n        }, 1);\n\n        // cc.log(\"onNextBtnClicked\")\n        this.gameApplication.soundManager.playSound(\"btn_click\");\n        this.nextGame(btn);\n    },\n\n    onPreviousBtnClicked(event) {\n        // cc.log(\"onPreviousBtnClicked\")\n        var btn = event.target.getComponent(cc.Button);\n        btn.interactable = false;\n        this.scheduleOnce(function () {\n            btn.interactable = true;\n        }, 1);\n\n        this.gameApplication.soundManager.playSound(\"btn_click\");\n        this.prevGame();\n    },\n\n    onReStarBtnClicked(event) {\n        this.isinigame =false;\n        this.timeIsUpNode.active = false;\n        var btn = event.target.getComponent(cc.Button);\n        btn.interactable = false;\n        this.scheduleOnce(function () {\n            btn.interactable = true;\n        }, 0.2);\n        window.gameApplication.soundManager.playSound(\"btn_click\");\n        window.gameApplication.openMainView();\n    },\n\n    onHelpBtnClicked(event) {\n\n        if (this.gameOver || this.myRole == null) {\n            return;\n        }\n        if (this.helpPath.length <= 0) {\n            return;\n        }\n        if (this.helpCount > 0) {\n            window.gameApplication.soundManager.playSound(\"btn_click\");\n            this.help();\n        } else {\n            window.gameApplication.soundManager.playSound(\"btn_click\");\n            this.shareFriendTip.active = true;\n        }\n    },\n\n\n\n    onWatchVideoBtnClicked(event) {\n        // this.gameApplication.soundManager.playSound(\"btn_click\");\n\n        // cc.log(\"onWatchVideoBtnClicked\");\n        event.target.getComponent(cc.Button).interactable = false;\n\n        var self = this;\n        SDK().showVideoAd(function (isCompleted) {\n            if (isCompleted) {\n                self.helpCount = plusHelp;\n            } else {\n                cc.log(\"播放视频广告失败\")\n            }\n\n            event.target.getComponent(cc.Button).interactable = true;\n            self.shareFriendTip.active = false;\n\n        }.bind(this));\n    },\n\n    onShareInvBtnClicked(event) {\n        // cc.log(\"onWatchVideoBtnClicked\");\n        // event.target.getComponent(cc.Button).interactable = false;\n        this.gameApplication.soundManager.playSound(\"btn_click\");\n\n        var self = this;\n        this.gameApplication.soundManager.playSound(\"done\");\n        SDK().getItem(\"all\", function (score) {\n            // SDK().share(score, function (isCompleted) {\n            //     if (isCompleted) {\n            //         self.helpCount = plusHelp;\n            //         console.log(\"邀请成功\")\n            //     } else {\n            //         console.log(\"邀请失败\")\n            //         self.showInvAgain(1, event);\n            //     }\n            //     event.target.getComponent(cc.Button).interactable = true;\n            //     self.shareFriendTip.active = false;\n            // });\n            \n            // D.sdk.openRewardAd(function(){\n            //     self.helpCount = plusHelp;\n            //     this.shareFriendTip.active = false;\n            // });\n\n        }.bind(this));\n    },\n\n    showInvAgain(type, event) {\n        var self = this;\n        this.invAgain.active = true;\n        var btn = cc.find(\"box/btn_4\", this.invAgain).getComponent(cc.Button);\n        btn.node.on('click', function () {\n            if (type == 1) {\n                self.onShareInvBtnClicked(event);\n            } else if (type == 2) {\n                self.onShareBtnClicked(event);\n            } else if (type == 3) {\n                self.getMoreTimeInv(event);\n            }\n            self.invAgain.active = false;\n        }, this);\n    },\n\n    onCloseWatchVideoTipClicked() {\n        this.gameApplication.soundManager.playSound(\"btn_click\");\n        this.shareFriendTip.active = false;\n    },\n\n\n    onShareBtnClicked(event) {\n        var self = this;\n        this.gameApplication.soundManager.playSound(\"btn_click\");\n        event.target.getComponent(cc.Button).interactable = false;\n        event.target.active = true;\n\n        this.gameApplication.soundManager.playSound(\"done\");\n        SDK().getItem(\"all\", function (score) {\n            SDK().share(score, function (isCompleted) {\n                event.target.getComponent(cc.Button).interactable = true;\n                event.target.active = true;\n                if (!isCompleted) {\n                    self.showInvAgain(2, event);\n                }\n\n            });\n\n        }.bind(this));\n    },\n\n    helpBtnShake() {\n        this.helpBtn.getComponent(\"AnimFunc\").shake();\n    },\n\n    onGiftBtnClicked() {\n        this.receiveGiftNode.active = false;\n    },\n\n\n\n    onPlayInterstitialGiftBtnClicked(event) {\n        // event.target.getComponent(cc.Button).interactable = false;\n        var self = this;\n\n        self.gameApplication.soundManager.playSound(\"done\");\n        SDK().showInterstitialAd(function (isCompleted) {\n            self.helpCount += 1;\n            // event.target.getComponent(cc.Button).interactable = true;\n            self.receiveGiftNode.active = true;\n            self.giftBtn.active = false;\n            console.log(\"_______OKOK\")\n        }, true);\n    }\n\n});\n"]}