{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\UI/assets\\Script\\UI\\LevelView.js"],"names":["cc","Class","extends","Component","properties","title","default","type","Label","starts","Node","pageView","PageView","content","levelItem","levelPage","levels","bid","Integer","mid","_lastOpenLid","lastOpenLid","get","set","val","updateCurrpage","gameApplication","Object","lastLid","onLoad","find","getComponent","start","init","string","keys","length","path","getConf","results","initContents","bind","self","SDK","getItem","score","toString","tmpId","arr","push","forEach","tmp_lid","tmp_path","hideAllItem","idx","level","initLevels","_updatePageView","log","openAllLevel","pageNode","instantiate","active","addPage","pageContent","getChildByName","total_level","i","i_str","itemNode","lid","tag","setItem","isOpen","node","pageAt","Math","ceil","scrollToPage","removeAllPages","onBackBtnClicked","openMainView","soundManager","playSound"],"mappings":"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","file":"LevelView.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\UI","sourcesContent":["cc.Class({\n    extends: cc.Component,\n//需要更多源码联系Q:852183691\n//或者\n//关注微信公众号“史于二”\n    properties: {\n        title: {\n            default: null,\n            type: cc.Label,\n        },\n        starts: {\n            default: null,\n            type: cc.Node,\n        },\n        pageView:{\n            default: null,\n            type: cc.PageView,\n        },\n        content: {\n            default: null,\n            type: cc.Node,\n        },\n        levelItem: {\n            default: null,\n            type: cc.Node,\n        },\n        levelPage: {\n            default: null,\n            type: cc.Node,\n        },\n        levels:{\n            default:{},\n        },\n        bid:{\n            default:0, \n            type:cc.Integer,\n        },\n        mid:{\n            default:0,\n            type:cc.Integer,\n        },\n        _lastOpenLid:{\n            default:0,\n            type:cc.Integer,\n        },\n        lastOpenLid:{\n            get(){\n                return this._lastOpenLid;\n            },\n            set(val){\n                this._lastOpenLid = val;\n                this.updateCurrpage();\n            },\n        },\n        gameApplication:{\n            default:null,\n            type:Object\n        },\n        lastLid:{\n            default:0,\n            type:cc.Integer,\n        },\n    },  \n\n    onLoad: function () {\n        this.gameApplication = cc.find(\"GameApplication\").getComponent(\"GameApplication\");\n    },\n\n    start () {\n\n    },\n\n    init(bid,mid){\n        this.title.string = \"\";\n\n        if((this.levels == null || Object.keys(this.levels).length <= 0) || this.bid != bid || this.mid != mid ){\n            this.bid = bid;\n            this.mid = mid;\n            // cc.log(\"conf/Level/level_\" + bid + '_' + mid)\n            var path = \"conf/level_list/level_\" + bid + '_' + mid;\n            this.gameApplication.getConf(path,function(results){\n                // cc.log(\"results:\",results);\n                this.levels = results;\n                this.initContents();\n            }.bind(this));\n\n        }else{\n            this.bid = bid;\n            this.mid = mid;\n            this.initContents();\n        }\n\n        var self = this;\n        SDK().getItem(bid+\"_\"+mid,function(score){\n            self.starts.getComponent(cc.Label).string = score.toString();\n\n            //预加载上下两关\n            var tmpId = score+1;\n            var arr = [];\n            arr.push(tmpId);\n\n            if(tmpId > 1){\n                arr.push(tmpId-1);\n            }\n            arr.forEach(function(tmp_lid){\n                var tmp_path = \"conf/level_detail/b_\"+bid+\"/\"+mid+\"/\"+tmp_lid;\n                // cc.log(\"------tmp_path:\",tmp_path);\n                self.gameApplication.getConf(tmp_path,null);\n            });\n\n        }.bind(this));\n    },\n\n    initContents(){\n        var self = this;\n        self.hideAllItem();\n\n        this.title.string = self.levels.title;\n        this.lastLid = 0;\n\n        this.bid = self.levels.bid;\n        this.mid = self.levels.mid;\n        var idx = 1;\n        self.levels.levels.forEach(function(level){\n            self.initLevels(level,idx);\n            idx++;\n        });\n        this.pageView._updatePageView();\n    },\n\n    initLevels(level,idx){\n\t\tcc.log(\"++++++++++open:\"+ level +\"--idx:\"+idx +\" -:- \"+openAllLevel);\n        if(idx < 1 || idx > 4){\n            return;\n        }\n\n        var pageNode = cc.instantiate(this.levelPage);\n        pageNode.active = true;\n        // cc.log(\"pageNode:\",pageNode);\n        this.pageView.addPage(pageNode);\n\n        var pageContent = pageNode.getChildByName(\"content\");\n        // cc.log(\"path\",path)\n        var total_level= level['total_level'];\n\t\t\n        for(let i = 1;i<=25;i++){\n            // var itemNode = cc.instantiate(this.levelItem);\n            // itemNode.parent = pageContent;\n            let i_str = i.toString();\n\n            let itemNode = pageContent.getChildByName(i_str);\n\n            if(i > level['total_level']){\n                itemNode.active = false;\n            }else{\n                let lid = ((idx-1)*25)+i;\n                itemNode.tag = lid;\n\n                //重置\n                this.setItem(itemNode,0,false,lid);\n\n                var self = this;\n                \n                //判断是否解锁\n                SDK().getItem(self.bid+\"_\"+self.mid+\"_\"+lid,function(score){\n                    // console.log(\"++++++++++score:\",lid,score);\n\t\t\t\t\t\n                    var isOpen = false;\n                    if(lid <= self.lastLid+1 || score > 0){\n                        isOpen = true;\n                        self.setItem(itemNode,score,isOpen,lid);\n                    }else if(openAllLevel){\n\t\t\t\t\t\t\n                        self.setItem(itemNode,score,true,lid);\n                    }\n\n                    if(score > 0){\n                        self.lastLid = lid;\n                    }\n                },itemNode,lid);\n            }\n        }\n\n    },\n\n    setItem(node,score,isOpen,lid){\n        // cc.log(\"node:\",node,isOpen)\n        cc.find(\"unlock\",node).active = isOpen;\n        cc.find(\"lock\",node).active = !isOpen;\n        cc.find(\"unlock/text\",node).getComponent(cc.Label).string = lid;\n        cc.find(\"lock/text\",node).getComponent(cc.Label).string = lid;\n\n        node.active = true;\n        // cc.find(\"stars/1\",node).active = score>=1;\n        // cc.find(\"stars/2\",node).active = score>=2;\n        // cc.find(\"stars/3\",node).active = score>=3;\n\n        if(isOpen){\n            this.lastOpenLid = lid;\n        }\n    },\n\n    updateCurrpage(){\n        var pageAt =  Math.ceil(this.lastOpenLid/30) - 1; \n        pageAt = pageAt>=0?pageAt:0;\n        // setCurrentPageIndex\n        this.pageView.scrollToPage(pageAt,false);\n    },\n\n    \n\n    hideAllItem(){\n        this.pageView.removeAllPages();\n    },\n\n    onBackBtnClicked(){\n        this.hideAllItem();   \n        this.gameApplication.openMainView();\n        this.gameApplication.soundManager.playSound(\"btn_click\");\n    },\n    // update (dt) {},\n});\n"]}